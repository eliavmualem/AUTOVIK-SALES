<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Top Service Commission</title>
</head>
<body>
    <h1>×‘×“×™×§×ª ×¢××œ×ª ×˜×•×¤ ×¡×¨×•×•×™×¡ ×œ×× ×”×œ×™ ×’'×™×œ×™</h1>
    <div id="results"></div>
    
    <script src="js/showroom-config.js"></script>
    <script src="js/calc-geely.js"></script>
    
    <script>
        console.log('ğŸ§ª Testing Top Service Commission for Geely Managers');
        
        // Create test containers
        const prefix = 'gm-2026-01';
        const empId = 'uri';
        
        // Create test input fields
        document.body.innerHTML += `
            <!-- Test inputs for Manager Uri -->
            <input type="hidden" id="${prefix}-${empId}-tradein-profit" value="0">
            <input type="hidden" id="${prefix}-${empId}-select-commission" value="0">
            <input type="hidden" id="${prefix}-${empId}-special-focus" value="0">
            <input type="hidden" id="${prefix}-${empId}-max-finance" value="0">
            <input type="hidden" id="${prefix}-${empId}-diff" value="0">
            
            <!-- Display spans -->
            <span id="${prefix}-${empId}-delivery-commission">0</span>
            <span id="${prefix}-${empId}-nps-deduction">0</span>
            <span id="${prefix}-${empId}-accessories-commission">0</span>
            <span id="${prefix}-${empId}-tradein-commission">0</span>
            <span id="${prefix}-${empId}-tradein-profit-display">0</span>
            <span id="${prefix}-${empId}-select-display">0</span>
            <span id="${prefix}-${empId}-finance-bonus">0</span>
            <span id="${prefix}-${empId}-insurance-commission">0</span>
            <span id="${prefix}-${empId}-top-service-commission">0</span>
            <span id="${prefix}-${empId}-special-focus-display">0</span>
            <span id="${prefix}-${empId}-max-finance-display">0</span>
            <span id="${prefix}-${empId}-diff-display">0</span>
            <span id="${prefix}-${empId}-total">0</span>
        `;
        
        // Test scenarios
        const scenarios = [
            {
                name: '×ª×¨×—×™×© 1: ××ª×—×ª ×œ×¡×£ - 4 ×—×‘×™×œ×•×ª, 85%',
                actualDeliveries: 20,
                npsScore: 80,
                totalAccessories: 50000,
                avgAccessories: 2500,
                tradeinCount: 5,
                tradeinPercent: 25,
                financePercent: 30,
                insurancePercent: 45,
                servicePercent: 85,
                servicePackages: 4,
                expectedTopService: 0  // ××ª×—×ª ×œ×¡×£ ×©×œ 5 ×—×‘×™×œ×•×ª
            },
            {
                name: '×ª×¨×—×™×© 2: 5 ×—×‘×™×œ×•×ª, 55% - ××™×Ÿ ×ª×’××•×œ',
                actualDeliveries: 20,
                npsScore: 80,
                totalAccessories: 50000,
                avgAccessories: 2500,
                tradeinCount: 5,
                tradeinPercent: 25,
                financePercent: 30,
                insurancePercent: 45,
                servicePercent: 55,
                servicePackages: 5,
                expectedTopService: 0  // ××ª×—×ª ×œ-60%
            },
            {
                name: '×ª×¨×—×™×© 3: 8 ×—×‘×™×œ×•×ª, 65% - 500â‚ª',
                actualDeliveries: 20,
                npsScore: 80,
                totalAccessories: 50000,
                avgAccessories: 2500,
                tradeinCount: 5,
                tradeinPercent: 25,
                financePercent: 30,
                insurancePercent: 45,
                servicePercent: 65,
                servicePackages: 8,
                expectedTopService: 500  // 60-69.9%
            },
            {
                name: '×ª×¨×—×™×© 4: 10 ×—×‘×™×œ×•×ª, 75% - 750â‚ª',
                actualDeliveries: 20,
                npsScore: 80,
                totalAccessories: 50000,
                avgAccessories: 2500,
                tradeinCount: 5,
                tradeinPercent: 25,
                financePercent: 30,
                insurancePercent: 45,
                servicePercent: 75,
                servicePackages: 10,
                expectedTopService: 750  // 70-79.9%
            },
            {
                name: '×ª×¨×—×™×© 5: 12 ×—×‘×™×œ×•×ª, 85% - 1250â‚ª',
                actualDeliveries: 20,
                npsScore: 80,
                totalAccessories: 50000,
                avgAccessories: 2500,
                tradeinCount: 5,
                tradeinPercent: 25,
                financePercent: 30,
                insurancePercent: 45,
                servicePercent: 85,
                servicePackages: 12,
                expectedTopService: 1250  // 80%+
            }
        ];
        
        let resultsHTML = '<h2>×ª×•×¦××•×ª ×‘×“×™×§×”:</h2>';
        let allPassed = true;
        
        scenarios.forEach((scenario, index) => {
            console.log(`\n--- ${scenario.name} ---`);
            
            const result = window.calculateGeelyManagerCommissions(
                prefix,
                empId,
                scenario.actualDeliveries,
                scenario.npsScore,
                scenario.totalAccessories,
                scenario.avgAccessories,
                scenario.tradeinCount,
                scenario.tradeinPercent,
                scenario.financePercent,
                scenario.insurancePercent,
                scenario.servicePercent,
                scenario.servicePackages
            );
            
            const passed = result.topServiceCommission === scenario.expectedTopService;
            allPassed = allPassed && passed;
            
            resultsHTML += `
                <div style="border: 2px solid ${passed ? 'green' : 'red'}; padding: 15px; margin: 10px 0; border-radius: 8px;">
                    <h3>${passed ? 'âœ…' : 'âŒ'} ${scenario.name}</h3>
                    <p><strong>×¤×¨×˜×™×:</strong> ${scenario.servicePackages} ×—×‘×™×œ×•×ª, ${scenario.servicePercent}% ×‘×™×¦×•×¢</p>
                    <p><strong>×¦×¤×•×™:</strong> â‚ª${scenario.expectedTopService}</p>
                    <p><strong>×”×ª×§×‘×œ:</strong> â‚ª${result.topServiceCommission}</p>
                    <p><strong>×¡×”"×› ×¢××œ×•×ª:</strong> â‚ª${result.total}</p>
                </div>
            `;
            
            console.log(`×—×‘×™×œ×•×ª: ${scenario.servicePackages}, ××—×•×–: ${scenario.servicePercent}%`);
            console.log(`×¢××œ×ª ×˜×•×¤ ×¡×¨×•×•×™×¡: â‚ª${result.topServiceCommission} (×¦×¤×•×™: â‚ª${scenario.expectedTopService})`);
            console.log(`×¡×”"×›: â‚ª${result.total}`);
            console.log(`âœ“ ${passed ? '×¢×‘×¨' : '× ×›×©×œ'}`);
        });
        
        if (allPassed) {
            resultsHTML += '<h2 style="color: green;">ğŸ‰ ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”!</h2>';
            console.log('\nğŸ‰ ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”!');
        } else {
            resultsHTML += '<h2 style="color: red;">âŒ ×—×œ×§ ××”×‘×“×™×§×•×ª × ×›×©×œ×•</h2>';
            console.log('\nâŒ ×—×œ×§ ××”×‘×“×™×§×•×ª × ×›×©×œ×•');
        }
        
        document.getElementById('results').innerHTML = resultsHTML;
    </script>
</body>
</html>
