<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <title>Simple Yearly Test</title>
    <style>
        body { font-family: Arial; padding: 20px; line-height: 1.6; }
        button { padding: 12px 24px; font-size: 16px; margin: 10px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 5px; }
        button:hover { background: #45a049; }
        .result { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; border-left: 4px solid #4CAF50; }
        pre { background: #fff; padding: 10px; border: 1px solid #ddd; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ×‘×“×™×§×” ×¤×©×•×˜×”: ×¡×™×›×•× ×©× ×ª×™</h1>
    
    <button onclick="step1()">×©×œ×‘ 1: ×©××•×¨ × ×ª×•× ×™ ×‘×“×™×§×”</button>
    <button onclick="step2()">×©×œ×‘ 2: ×”×¦×’ ×¡×™×›×•× ×©× ×ª×™</button>
    <button onclick="step3()">×©×œ×‘ 3: × ×§×” ×”×›×œ</button>
    
    <div id="result" class="result" style="display: none;"></div>
    <div id="hyundai-modiin-yearly-summary-content"></div>
    
    <script src="js/showroom-config.js"></script>
    
    <script>
        // Set global variable
        window.currentShowroom = 'hyundai-modiin';
        
        function step1() {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.innerHTML = '<h3>×©×•××¨ × ×ª×•× ×™×...</h3>';
            
            const testData = {
                showroomId: 'hyundai-modiin',
                prefix: 'hm-2026-01',
                branchTarget: 25,
                totalCars: 25,
                totalTopService: 15,
                totalTopServicePot: 20,
                totalInsurance: 18,
                employees: {},
                employeeResults: {
                    guy: { 
                        vehiclesComponent: 5000, 
                        tradeInComponent: 0, 
                        financeComponent: 0, 
                        total: 5000 
                    },
                    dario: { 
                        vehiclesComponent: 3500, 
                        tradeInComponent: 200, 
                        financeComponent: 100, 
                        total: 3800 
                    },
                    asher: { 
                        vehiclesComponent: 1200, 
                        tradeInComponent: 0, 
                        financeComponent: 0, 
                        total: 1950 
                    }
                }
            };
            
            const allData = JSON.parse(localStorage.getItem('commissionData') || '{}');
            if (!allData['hyundai-modiin']) allData['hyundai-modiin'] = {};
            allData['hyundai-modiin']['2026-01'] = {
                calculatedResults: testData,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('commissionData', JSON.stringify(allData));
            
            result.innerHTML += '<p style="color: green;">âœ… × ×ª×•× ×™× × ×©××¨×• ×œ-localStorage</p>';
            result.innerHTML += '<pre>' + JSON.stringify(testData.employeeResults, null, 2) + '</pre>';
        }
        
        function step2() {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.innerHTML = '<h3>××¦×™×’ ×¡×™×›×•× ×©× ×ª×™...</h3>';
            
            // Inline displayYearlySummary simplified
            const showroomId = 'hyundai-modiin';
            const allData = JSON.parse(localStorage.getItem('commissionData') || '{}');
            const showroomData = allData[showroomId] || {};
            
            result.innerHTML += `<p>× ×ª×•× ×™× × ××¦××•: ${Object.keys(showroomData).length} ×—×•×“×©×™×</p>`;
            
            const config = window.getShowroomConfig(showroomId);
            const allEmployees = window.getShowroomEmployees(showroomId);
            
            result.innerHTML += `<p>×¢×•×‘×“×™×: ${allEmployees.length}</p>`;
            
            // Initialize totals
            const employeeTotals = {};
            allEmployees.forEach(emp => {
                employeeTotals[emp.id] = { 
                    name: emp.name, 
                    role: emp.role,
                    vehicles: 0, 
                    tradeIn: 0, 
                    finance: 0, 
                    total: 0, 
                    months: [] 
                };
            });
            
            // Collect data
            const months = ['2026-01', '2026-02', '2026-03', '2026-04', '2026-05', '2026-06',
                            '2026-07', '2026-08', '2026-09', '2026-10', '2026-11', '2026-12'];
            
            months.forEach(month => {
                if (showroomData[month] && showroomData[month].calculatedResults && 
                    showroomData[month].calculatedResults.employeeResults) {
                    const empResults = showroomData[month].calculatedResults.employeeResults;
                    
                    Object.keys(empResults).forEach(empKey => {
                        if (employeeTotals[empKey]) {
                            employeeTotals[empKey].vehicles += empResults[empKey].vehiclesComponent || 0;
                            employeeTotals[empKey].tradeIn += empResults[empKey].tradeInComponent || 0;
                            employeeTotals[empKey].finance += empResults[empKey].financeComponent || 0;
                            employeeTotals[empKey].total += empResults[empKey].total || 0;
                            employeeTotals[empKey].months.push(month);
                        }
                    });
                }
            });
            
            result.innerHTML += '<h4>×ª×•×¦××•×ª:</h4>';
            Object.keys(employeeTotals).forEach(empKey => {
                const emp = employeeTotals[empKey];
                if (emp.months.length > 0) {
                    result.innerHTML += `<p><strong>${emp.name}</strong>: â‚ª${emp.total.toLocaleString()} (${emp.months.length} ×—×•×“×©×™×)</p>`;
                }
            });
            
            // Display in summary element
            const summaryEl = document.getElementById('hyundai-modiin-yearly-summary-content');
            let html = '<div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">';
            html += '<h2 style="text-align: center; color: #764ba2;">ğŸ“Š ×¡×™×›×•× ×©× ×ª×™ 2026</h2>';
            html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">';
            
            Object.keys(employeeTotals).forEach(empKey => {
                const emp = employeeTotals[empKey];
                if (emp.months.length > 0) {
                    html += `
                        <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; border: 2px solid #4CAF50;">
                            <h3 style="color: #333; margin: 0 0 10px 0;">${emp.name}</h3>
                            <p style="color: #666; font-size: 14px;">${emp.role}</p>
                            <p style="font-size: 12px; color: #999;">×—×•×“×©×™×: ${emp.months.length}/12</p>
                            <hr style="margin: 10px 0;">
                            <p><strong>×¨×›×™×‘ ×¨×›×‘×™×:</strong> â‚ª${emp.vehicles.toLocaleString()}</p>
                            ${emp.tradeIn > 0 ? `<p><strong>×˜×¨×™×™×“ ××™×Ÿ:</strong> â‚ª${emp.tradeIn.toLocaleString()}</p>` : ''}
                            ${emp.finance > 0 ? `<p><strong>××™××•×Ÿ:</strong> â‚ª${emp.finance.toLocaleString()}</p>` : ''}
                            <p style="font-size: 18px; font-weight: bold; color: #4CAF50; margin-top: 10px;">×¡×”"×›: â‚ª${emp.total.toLocaleString()}</p>
                        </div>
                    `;
                }
            });
            
            html += '</div></div>';
            summaryEl.innerHTML = html;
        }
        
        function step3() {
            localStorage.removeItem('commissionData');
            document.getElementById('result').innerHTML = '<p style="color: orange;">ğŸ—‘ï¸ localStorage × ×•×§×”</p>';
            document.getElementById('hyundai-modiin-yearly-summary-content').innerHTML = '';
        }
    </script>
</body>
</html>
