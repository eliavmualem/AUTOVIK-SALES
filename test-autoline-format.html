<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <title>Test: Autoline Format</title>
    <link rel="stylesheet" href="css/new-layout.css">
</head>
<body>
    <div class="page-container">
        <h1>ğŸ§ª ×‘×“×™×§×”: ×¤×•×¨××˜ ××•×˜×•×œ×™×Ÿ</h1>
        <h2>×™×•× ×“××™ ××•×“×™×¢×™×Ÿ</h2>
        
        <div id="test-area"></div>
        
        <button onclick="step1()" style="margin: 20px; padding: 15px 30px; font-size: 18px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
            â–¶ï¸ ×©×œ×‘ 1: ×—×©×‘ ×•×©××•×¨
        </button>
        
        <button onclick="step2()" style="margin: 20px; padding: 15px 30px; font-size: 18px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
            ğŸ“Š ×©×œ×‘ 2: ×”×¦×’ ×¡×™×›×•× ×©× ×ª×™
        </button>
        
        <div id="hyundai-modiin-yearly-summary-content" style="margin: 20px;"></div>
        
        <div style="margin: 20px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
            <h3>ğŸ“‹ ×œ×•×’:</h3>
            <pre id="log" style="max-height: 400px; overflow-y: auto;"></pre>
        </div>
    </div>

    <script src="js/showroom-config.js"></script>
    <script src="js/generic-layout-generator.js"></script>
    <script src="js/calc-generic.js"></script>
    <script src="js/generic-storage.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        const showroomId = 'hyundai-modiin';
        const month = '2026-01';
        window.currentShowroom = showroomId;
        let logText = '';
        
        function log(msg) {
            logText += msg + '\n';
            document.getElementById('log').textContent = logText;
            console.log(msg);
        }
        
        // Generate UI
        const layout = window.createGenericMonthLayout(showroomId, month);
        document.getElementById('test-area').innerHTML = layout;
        log('âœ… UI × ×•×¦×¨');
        
        function step1() {
            log('\nğŸ“ ×©×œ×‘ 1: ××–×™×Ÿ × ×ª×•× ×™×...');
            
            // Fill data
            document.getElementById('hm-2026-01-guy-cars').value = 5;
            document.getElementById('hm-2026-01-dario-cars').value = 20;
            document.getElementById('hm-2026-01-dario-topservice').value = 15;
            document.getElementById('hm-2026-01-dario-topservice-potential').value = 20;
            document.getElementById('hm-2026-01-dario-target').value = 20;
            document.getElementById('hm-2026-01-dario-insurance').value = 8;
            document.getElementById('hm-2026-01-dario-finance').value = 100;
            document.getElementById('hm-2026-01-dario-tradein').value = 200;
            document.getElementById('hm-2026-01-asher-insurance').value = 10;
            document.getElementById('hm-2026-01-branch-target').value = 25;
            
            log('  - × ×ª×•× ×™× ×”×•×–× ×•');
            
            // Calculate
            window.calculateGenericMonth(showroomId, month);
            log('  - ×—×™×©×•×‘ ×‘×•×¦×¢');
            
            // Check lastCalculatedResults
            log('\nğŸ” ×‘×“×™×§×ª window.lastCalculatedResults:');
            log(`  - ×§×™×™×: ${window.lastCalculatedResults ? '×›×Ÿ' : '×œ×'}`);
            if (window.lastCalculatedResults) {
                log(`  - ×™×© [${month}]: ${window.lastCalculatedResults[month] ? '×›×Ÿ' : '×œ×'}`);
                if (window.lastCalculatedResults[month]) {
                    log(`  - ×¢×•×‘×“×™×: ${Object.keys(window.lastCalculatedResults[month]).join(', ')}`);
                    log(`  - ×’×™× ×¡×”"×›: ${window.lastCalculatedResults[month].guy?.total || 'N/A'}`);
                    log(`  - ×“×¨×™×• ×¡×”"×›: ${window.lastCalculatedResults[month].dario?.total || 'N/A'}`);
                }
            }
            
            // Save
            log('\nğŸ’¾ ×©×•××¨ × ×ª×•× ×™×...');
            window.saveGenericMonth(showroomId, month);
            log('  - × ×ª×•× ×™× × ×©××¨×•');
            
            // Check localStorage
            const allData = JSON.parse(localStorage.getItem('commissionData') || '{}');
            const saved = allData[showroomId]?.[month];
            log(`  - × ××¦× ×‘-localStorage: ${saved ? '×›×Ÿ' : '×œ×'}`);
            log(`  - ×™×© calculatedResults: ${saved?.calculatedResults ? '×›×Ÿ' : '×œ×'}`);
            if (saved?.calculatedResults) {
                log(`  - ×¢×•×‘×“×™× ×©××•×¨×™×: ${Object.keys(saved.calculatedResults).join(', ')}`);
            }
        }
        
        function step2() {
            log('\nğŸ“Š ×©×œ×‘ 2: ××¦×™×’ ×¡×™×›×•× ×©× ×ª×™...');
            
            window.displayYearlySummary();
            
            setTimeout(() => {
                const summaryEl = document.getElementById('hyundai-modiin-yearly-summary-content');
                const content = summaryEl ? summaryEl.innerHTML : '';
                
                if (content.includes('×˜×•×¢×Ÿ')) {
                    log('âŒ ×¢×“×™×™×Ÿ "×˜×•×¢×Ÿ..." - ×œ× ×”×ª×¢×“×›×Ÿ!');
                } else if (content.includes('××™×Ÿ ×¢×“×™×™×Ÿ × ×ª×•× ×™×')) {
                    log('âŒ "××™×Ÿ × ×ª×•× ×™×" - ×œ× ××¦× × ×ª×•× ×™×!');
                } else if (content.includes('×’×™× ×”×¨×¨×™') || content.includes('×¡×”"×› ×©× ×ª×™')) {
                    log('âœ… ×”×¡×™×›×•× ×”×•×¦×’ ×‘×”×¦×œ×—×”!');
                    log('  - × ××¦××• ×›×¨×˜×™×¡×™ ×¢×•×‘×“×™×');
                } else {
                    log('â“ ×ª×•×›×Ÿ ×œ× ×‘×¨×•×¨');
                }
            }, 500);
        }
    </script>
</body>
</html>
