<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Full Yearly Summary Flow</title>
    <link rel="stylesheet" href="css/new-layout.css">
</head>
<body>
    <div class="page-container">
        <h1>ğŸ§ª ×‘×“×™×§×” ××œ××”: ×©××™×¨×” â†’ ×¡×™×›×•× ×©× ×ª×™</h1>
        
        <div id="step1" style="margin: 20px; padding: 20px; background: #f0f8ff; border-radius: 8px;">
            <h2>×©×œ×‘ 1: ×”×–× ×ª × ×ª×•× ×™×</h2>
            <div id="test-area"></div>
            <button onclick="runStep1()" style="margin-top: 20px; padding: 10px 20px; font-size: 16px;">â–¶ï¸ ×”×–×Ÿ × ×ª×•× ×™× ×•×—×©×‘</button>
        </div>
        
        <div id="step2" style="margin: 20px; padding: 20px; background: #fffacd; border-radius: 8px; display: none;">
            <h2>×©×œ×‘ 2: ×©××™×¨×”</h2>
            <button onclick="runStep2()" style="padding: 10px 20px; font-size: 16px;">ğŸ’¾ ×©××•×¨ × ×ª×•× ×™×</button>
        </div>
        
        <div id="step3" style="margin: 20px; padding: 20px; background: #e0ffe0; border-radius: 8px; display: none;">
            <h2>×©×œ×‘ 3: ×¡×™×›×•× ×©× ×ª×™</h2>
            <div id="yearly-summary-area"></div>
            <button onclick="runStep3()" style="padding: 10px 20px; font-size: 16px;">ğŸ“Š ×”×¦×’ ×¡×™×›×•× ×©× ×ª×™</button>
        </div>
        
        <div style="margin-top: 30px; padding: 20px; background: #f0f0f0; border-radius: 8px;">
            <h3>ğŸ“‹ ×œ×•×’:</h3>
            <div id="log" style="font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <script src="js/showroom-config.js"></script>
    <script src="js/generic-layout-generator.js"></script>
    <script src="js/calc-generic.js"></script>
    <script src="js/generic-storage.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        const showroomId = 'hyundai-modiin';
        const month = '2026-01';
        let logContent = '';
        
        function log(msg) {
            logContent += msg + '\n';
            document.getElementById('log').textContent = logContent;
            console.log(msg);
        }
        
        // Initialize
        window.currentShowroom = showroomId;
        
        log('ğŸš€ ××¢×¨×›×ª ××•×ª×—×œ×”');
        log(`××•×œ×: ${showroomId}`);
        log(`×—×•×“×©: ${month}`);
        
        // Generate UI
        const layout = window.createGenericMonthLayout(showroomId, month);
        document.getElementById('test-area').innerHTML = layout;
        log('âœ… UI × ×•×¦×¨');
        
        function runStep1() {
            log('\nğŸ“ ×©×œ×‘ 1: ××–×™×Ÿ × ×ª×•× ×™×...');
            
            // Fill data
            document.getElementById('hm-2026-01-guy-cars').value = 5;
            document.getElementById('hm-2026-01-dario-cars').value = 20;
            document.getElementById('hm-2026-01-dario-topservice').value = 15;
            document.getElementById('hm-2026-01-dario-topservice-potential').value = 20;
            document.getElementById('hm-2026-01-dario-target').value = 20;
            document.getElementById('hm-2026-01-dario-insurance').value = 8;
            document.getElementById('hm-2026-01-dario-finance').value = 100;
            document.getElementById('hm-2026-01-dario-tradein').value = 200;
            document.getElementById('hm-2026-01-branch-target').value = 25;
            
            log('  - × ×ª×•× ×™× ×”×•×–× ×•');
            
            // Calculate
            window.calculateGenericMonth(showroomId, month);
            log('  - ×—×™×©×•×‘ ×‘×•×¦×¢');
            log(`  - ×’×™× ×¡×”"×›: ${document.getElementById('hm-2026-01-guy-total-display').textContent}`);
            log(`  - ×“×¨×™×• ×¡×”"×›: ${document.getElementById('hm-2026-01-dario-total-display').textContent}`);
            
            document.getElementById('step2').style.display = 'block';
        }
        
        function runStep2() {
            log('\nğŸ’¾ ×©×œ×‘ 2: ×©×•××¨ × ×ª×•× ×™×...');
            
            // Save
            window.saveGenericMonth(showroomId, month);
            log('  - × ×ª×•× ×™× × ×©××¨×•');
            
            // Check localStorage
            const allData = JSON.parse(localStorage.getItem('commissionData') || '{}');
            const saved = allData[showroomId]?.[month];
            log(`  - × ××¦× ×‘-localStorage: ${saved ? '×›×Ÿ âœ…' : '×œ× âŒ'}`);
            log(`  - ×™×© calculatedResults: ${saved?.calculatedResults ? '×›×Ÿ âœ…' : '×œ× âŒ'}`);
            log(`  - ×™×© employeeResults: ${saved?.calculatedResults?.employeeResults ? '×›×Ÿ âœ…' : '×œ× âŒ'}`);
            
            if (saved?.calculatedResults?.employeeResults) {
                log(`  - ××¡×¤×¨ ×¢×•×‘×“×™×: ${Object.keys(saved.calculatedResults.employeeResults).length}`);
                Object.keys(saved.calculatedResults.employeeResults).forEach(empId => {
                    const res = saved.calculatedResults.employeeResults[empId];
                    log(`    - ${empId}: ×¡×”"×› ${res.total}`);
                });
            }
            
            document.getElementById('step3').style.display = 'block';
        }
        
        function runStep3() {
            log('\nğŸ“Š ×©×œ×‘ 3: ××¦×™×’ ×¡×™×›×•× ×©× ×ª×™...');
            
            // Create yearly summary element
            const config = window.getShowroomConfig(showroomId);
            const yearlyDiv = document.createElement('div');
            yearlyDiv.innerHTML = `
                <div id="${showroomId}-yearly-summary-content">
                    <p style="text-align: center; padding: 20px;">â³ ×˜×•×¢×Ÿ...</p>
                </div>
            `;
            document.getElementById('yearly-summary-area').appendChild(yearlyDiv);
            
            log('  - ××œ×× ×˜ yearly summary × ×•×¦×¨');
            
            // Call displayYearlySummary
            setTimeout(() => {
                log('  - ×§×•×¨× ×œ-displayYearlySummary...');
                window.displayYearlySummary();
                log('  - displayYearlySummary ×”×¡×ª×™×™×');
                
                // Check result
                const content = document.getElementById(`${showroomId}-yearly-summary-content`).innerHTML;
                if (content.includes('×˜×•×¢×Ÿ')) {
                    log('âŒ ×¢×“×™×™×Ÿ ××¦×™×’ "×˜×•×¢×Ÿ..." - ×œ× ×”×ª×¢×“×›×Ÿ!');
                } else if (content.includes('××™×Ÿ ×¢×“×™×™×Ÿ × ×ª×•× ×™×')) {
                    log('âŒ ××¦×™×’ "××™×Ÿ × ×ª×•× ×™×" - ×œ× ××¦× × ×ª×•× ×™× ×©××•×¨×™×!');
                } else {
                    log('âœ… ×¡×™×›×•× ×©× ×ª×™ ×”×•×¦×’ ×‘×”×¦×œ×—×”!');
                }
            }, 500);
        }
    </script>
</body>
</html>
