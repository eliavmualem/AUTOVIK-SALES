<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug: Yearly Summary</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .step { margin: 20px 0; padding: 15px; border: 2px solid #ccc; border-radius: 8px; }
        .success { background: #d4edda; border-color: #28a745; }
        .error { background: #f8d7da; border-color: #dc3545; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ×‘×“×™×§×ª ×¡×™×›×•× ×©× ×ª×™ - ×™×•× ×“××™ ××•×“×™×¢×™×Ÿ</h1>
    
    <div class="step">
        <h2>×©×œ×‘ 1: ×‘×“×™×§×ª ×§×‘×¦×™×</h2>
        <button onclick="checkFiles()">ğŸ” ×‘×“×•×§ ×§×‘×¦×™×</button>
        <div id="files-result"></div>
    </div>
    
    <div class="step">
        <h2>×©×œ×‘ 2: ×©××™×¨×ª × ×ª×•× ×™×</h2>
        <button onclick="saveTestData()">ğŸ’¾ ×©××•×¨ × ×ª×•× ×™ ×‘×“×™×§×”</button>
        <div id="save-result"></div>
    </div>
    
    <div class="step">
        <h2>×©×œ×‘ 3: ×‘×“×™×§×ª localStorage</h2>
        <button onclick="checkLocalStorage()">ğŸ“¦ ×‘×“×•×§ localStorage</button>
        <div id="storage-result"></div>
    </div>
    
    <div class="step">
        <h2>×©×œ×‘ 4: ×”×¦×’×ª ×¡×™×›×•× ×©× ×ª×™</h2>
        <button onclick="testYearlySummary()">ğŸ“Š ×”×¦×’ ×¡×™×›×•×</button>
        <div id="yearly-result"></div>
        <div id="hyundai-modiin-yearly-summary-content" style="margin-top: 20px; padding: 20px; background: white; border: 1px solid #ccc; border-radius: 5px;"></div>
    </div>

    <script src="js/showroom-config.js"></script>
    <script src="js/calc-generic.js"></script>
    <script src="js/generic-storage.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        const showroomId = 'hyundai-modiin';
        const month = '2026-01';
        window.currentShowroom = showroomId;
        
        function checkFiles() {
            const result = document.getElementById('files-result');
            let html = '<h3>×‘×“×™×§×ª ×§×‘×¦×™×:</h3><ul>';
            
            html += `<li>window.getShowroomConfig: ${typeof window.getShowroomConfig === 'function' ? 'âœ…' : 'âŒ'}</li>`;
            html += `<li>window.calculateGenericMonth: ${typeof window.calculateGenericMonth === 'function' ? 'âœ…' : 'âŒ'}</li>`;
            html += `<li>window.saveGenericMonth: ${typeof window.saveGenericMonth === 'function' ? 'âœ…' : 'âŒ'}</li>`;
            html += `<li>window.displayYearlySummary: ${typeof window.displayYearlySummary === 'function' ? 'âœ…' : 'âŒ'}</li>`;
            
            const config = window.getShowroomConfig ? window.getShowroomConfig(showroomId) : null;
            html += `<li>Config exists: ${config ? 'âœ…' : 'âŒ'}</li>`;
            if (config) {
                html += `<li>Config name: ${config.name}</li>`;
                html += `<li>Config prefix: ${config.prefix}</li>`;
            }
            
            html += '</ul>';
            result.innerHTML = html;
        }
        
        function saveTestData() {
            const result = document.getElementById('save-result');
            
            try {
                // Manually create test data
                const testData = {
                    showroomId: showroomId,
                    prefix: 'hm-2026-01',
                    branchTarget: 25,
                    totalCars: 25,
                    totalTopService: 15,
                    totalTopServicePot: 20,
                    totalInsurance: 18,
                    employees: {
                        guy: { type: 'manager', cars: 5, finance: 0, tradeIn: 0, demo: 0, diff: 0 },
                        dario: { type: 'salesperson', target: 20, cars: 20, insurance: 8, topService: 15, topServicePot: 20, warranty: 0, mystery: 0, demo: 0, diff: 0, finance: 100, tradeIn: 200 },
                        sales2: { type: 'salesperson', target: 0, cars: 0, insurance: 0, topService: 0, topServicePot: 0, warranty: 0, mystery: 0, demo: 0, diff: 0, finance: 0, tradeIn: 0 },
                        asher: { type: 'operations', insurance: 10 }
                    },
                    employeeResults: {
                        guy: { vehiclesComponent: 5000, tradeInComponent: 0, financeComponent: 0, total: 5000 },
                        dario: { vehiclesComponent: 3500, tradeInComponent: 200, financeComponent: 100, total: 3800 },
                        sales2: { vehiclesComponent: 0, tradeInComponent: 0, financeComponent: 0, total: 0 },
                        asher: { vehiclesComponent: 1950, tradeInComponent: 0, financeComponent: 0, total: 1950 }
                    }
                };
                
                // Save to localStorage
                const allData = JSON.parse(localStorage.getItem('commissionData') || '{}');
                if (!allData[showroomId]) allData[showroomId] = {};
                allData[showroomId][month] = {
                    'test-field': 'test-value',
                    calculatedResults: testData,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('commissionData', JSON.stringify(allData));
                
                result.innerHTML = `<p style="color: green;">âœ… × ×ª×•× ×™ ×‘×“×™×§×” × ×©××¨×•!</p>
                    <pre>${JSON.stringify(testData.employeeResults, null, 2)}</pre>`;
                    
            } catch (error) {
                result.innerHTML = `<p style="color: red;">âŒ ×©×’×™××”: ${error.message}</p>`;
            }
        }
        
        function checkLocalStorage() {
            const result = document.getElementById('storage-result');
            
            const allData = JSON.parse(localStorage.getItem('commissionData') || '{}');
            const showroomData = allData[showroomId] || {};
            const monthData = showroomData[month];
            
            let html = '<h3>×ª×•×›×Ÿ localStorage:</h3>';
            html += `<p>×™×© × ×ª×•× ×™× ×œ-${showroomId}: ${showroomData ? 'âœ…' : 'âŒ'}</p>`;
            html += `<p>×™×© × ×ª×•× ×™× ×œ-${month}: ${monthData ? 'âœ…' : 'âŒ'}</p>`;
            
            if (monthData) {
                html += `<p>×™×© calculatedResults: ${monthData.calculatedResults ? 'âœ…' : 'âŒ'}</p>`;
                if (monthData.calculatedResults) {
                    html += `<p>×™×© employeeResults: ${monthData.calculatedResults.employeeResults ? 'âœ…' : 'âŒ'}</p>`;
                    if (monthData.calculatedResults.employeeResults) {
                        const empResults = monthData.calculatedResults.employeeResults;
                        html += `<p>××¡×¤×¨ ×¢×•×‘×“×™×: ${Object.keys(empResults).length}</p>`;
                        html += '<pre>' + JSON.stringify(empResults, null, 2) + '</pre>';
                    }
                }
            }
            
            result.innerHTML = html;
        }
        
        function testYearlySummary() {
            const result = document.getElementById('yearly-result');
            
            try {
                result.innerHTML = '<p>ğŸ”„ ××¨×™×¥ displayYearlySummary...</p>';
                
                if (typeof window.displayYearlySummary !== 'function') {
                    result.innerHTML = '<p style="color: red;">âŒ ×”×¤×•× ×§×¦×™×” displayYearlySummary ×œ× ×§×™×™××ª!</p>';
                    return;
                }
                
                // Run the function
                window.displayYearlySummary();
                
                // Check result
                const summaryEl = document.getElementById('hyundai-modiin-yearly-summary-content');
                const content = summaryEl ? summaryEl.innerHTML : '××œ×× ×˜ ×œ× × ××¦×';
                
                let status = '';
                if (content.includes('×˜×•×¢×Ÿ')) {
                    status = 'âš ï¸ ×¢×“×™×™×Ÿ ××¦×™×’ "×˜×•×¢×Ÿ..." - ×”×¤×•× ×§×¦×™×” ×œ× ×”×ª×¢×“×›× ×”!';
                } else if (content.includes('××™×Ÿ ×¢×“×™×™×Ÿ × ×ª×•× ×™×')) {
                    status = 'âš ï¸ ××¦×™×’ "××™×Ÿ × ×ª×•× ×™×" - ×œ× ××¦× × ×ª×•× ×™× ×©××•×¨×™×!';
                } else if (content.includes('×’×™× ×”×¨×¨×™') || content.includes('×“×¨×™×•')) {
                    status = 'âœ… ×”×¡×™×›×•× ×”×•×¦×’ ×‘×”×¦×œ×—×”!';
                } else {
                    status = 'â“ ×œ× ×‘×¨×•×¨ ××” ×”×ª×•×›×Ÿ';
                }
                
                result.innerHTML = `<p><strong>${status}</strong></p>`;
                
            } catch (error) {
                result.innerHTML = `<p style="color: red;">âŒ ×©×’×™××”: ${error.message}</p><pre>${error.stack}</pre>`;
            }
        }
    </script>
</body>
</html>
